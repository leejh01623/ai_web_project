<html>
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
			integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
			crossorigin="anonymous"
		/>

		<title>Play 자판기</title>
		<link rel="stylesheet" href="styleSubPage6.css" />
		<meta property="og:url" content="https://aizapangi.netlify.app/survivegameDesc.html" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="Play 자판기(새끼동물퀴즈)" />
		<meta property="og:description" content="그래! 결심했어! 오늘의 저녁 메뉴는 바로 이거야!"/>
		<meta property="og:image" content="https://github.com/leejh01623/ai_web_project/blob/master/img2/muindo_thumb.jpg?raw=true" />
		
		<!-- Go to www.addthis.com/dashboard to customize your tools -->
		<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f1f0db73bbe7b4a"></script>
		
		<!-- sweetAlert
		<!-- <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> -->
		<script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
	</head>
	<body>
		<!-- 네비게이션바 -->
		<nav class="navbar navbar-expand-lg navbar-light navbar-padding">
			<button
				class="navbar-toggler custom-toggler"
				type="button"
				data-toggle="collapse"
				data-target="#navbarNav"
				aria-controls="navbarNav"
				aria-expanded="false"
				aria-label="Toggle navigation"
			>
				<span class="navbar-toggler-icon"></span>
			</button>
			<a class="navbar-brand" href="../index.html">RaccoonForest</a>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav">
					<li class="nav-item active">
						<a class="nav-link" href="../index.html">Home <span class="sr-only">(current)</span></a>
					</li>
					<!--
					<li class="nav-item">
						<a class="nav-link" href="#">Notice</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">About Us</a>
					</li>
					-->
				</ul>
			</div>
		</nav>
		
		<!-- life 갯수 영역 -->
		<div class="life-time-div">
			<div class="life-div">
				<div class="life-img" id="life_count_id_2">
					
				</div>
				<div class="life-img" id="life_count_id_1">
					
				</div>
				<div class="life-img" id="life_count_id_0">
					
				</div>
			</div>
			<div class="time-div">
				<div class="time-progress-div" id="time_progress_id"></div>
			</div>
		</div>
		
		<!-- 문제 번호 영역 -->
		<div class="problem-num-div">
			<div class="problem-num-text-div">
				<span class="problem-num-text" id="problem_num_text_id"></span>
			</div>
		</div>
		
		<!-- 문제 이미지 영역 -->
		<div class="problem-img-div" id="problem_img_id">
			
		</div>
		
		<!-- 정답 Text 영역 -->
		<div class="answer-div" id="answer_id">
			
		</div>
		
		<!-- 정답 선택 영역 영역 -->
		<div class="choice-div">
			<div class="choice-line">
				<button class="choice-btn" onclick="choiceFunc(0);">
					<span class="choice-text" id="choice_0"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(1);">
					<span class="choice-text" id="choice_1"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(2);">
					<span class="choice-text" id="choice_2"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(3);">
					<span class="choice-text" id="choice_3"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(4);">
					<span class="choice-text" id="choice_4"/>
				</button>
			</div>
			<div class="choice-line">
				<button class="choice-btn" onclick="choiceFunc(5);">
					<span class="choice-text" id="choice_5"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(6);">
					<span class="choice-text" id="choice_6"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(7);">
					<span class="choice-text" id="choice_7"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(8);">
					<span class="choice-text" id="choice_8"/>
				</button>
				<button class="choice-btn" onclick="choiceFunc(9);">
					<span class="choice-text" id="choice_9"/>
				</button>
			</div>
		</div>
				
		
		<script>
			var life_count_id_2, life_count_id_1, life_count_id_0, time_progress_id, answer_id, problem_img_id, problem_num_text_id;
			var choice_arr, alphabet_arr, text_arr, text_line_arr, answer_tmp_arr;
			var problem_num, problem_img, answer, problem_count = 0, life_count = 3;
			
			var timeProgressChk = 0;
			var startTime, timeProgressWidth;
			
			// babyanimals.txt 읽어오기
			readFile("./raw/babyanimals.txt");

			setInit();
			
			// 라이프 수
			setLifeCount();
			
			// 문제 풀이 제한 시간(24초)
			//setTimeProgress();
			
			// 문제 번호 설정
			setProblemNum();
			
			// 문제 이미지 설정
			setProblemImg();
			
			// 문제 정답칸 설정
			setAnswer();
			
			// 문제 보기 설정
			setChoiceBtn();
		
			function setInit(){
				life_count_id_2 = document.getElementById("life_count_id_2");
				life_count_id_1 = document.getElementById("life_count_id_1");
				life_count_id_0 = document.getElementById("life_count_id_0");
				time_progress_id = document.getElementById("time_progress_id");
				answer_id = document.getElementById("answer_id");
				problem_img_id = document.getElementById("problem_img_id");
				
				problem_num_text_id = document.getElementById("problem_num_text_id");
				
				text_line_arr = text_arr[problem_count].split("/");
				problem_num = text_line_arr[0];
				problem_img = text_line_arr[1];
				answer = text_line_arr[2];
				answer = answer.toUpperCase();
				
				answer_tmp_arr = new Array(answer.length);
			}
			
			function readFile(file){
				var rawFile = new XMLHttpRequest();
				rawFile.open("GET", file, false);
				rawFile.onreadystatechange = function ()
				{
					if(rawFile.readyState === 4)
					{
						if(rawFile.status === 200 || rawFile.status == 0)
						{
							var allText = rawFile.responseText;
							text_arr = allText.split("\n");
						}
					}
				}
				rawFile.send(null);
			}
			
			function setLifeCount(){
				
			}
			
			function setTimeProgress(){
				if(timeProgressChk == 0){
					timeProgressChk = 1;
					timeProgressWidth = 10;
					startTime = setInterval(frame, 10);
				}
			}
			
			function frame() {
				if(timeProgressWidth >= 250){
					gameOverCheckFunc();
				} else {
					timeProgressWidth = timeProgressWidth + 0.1;
					time_progress_id.style.width = timeProgressWidth + "px";
				}
			}
			
			function gameOverCheckFunc(){
				clearInterval(startTime);
				timeProgressChk = 0;
				life_count--;
				
				if(life_count === 2){
					life_count_id_2.style.backgroundImage = "url('./img/emptylife.png')";
				} else if(life_count === 1){
					life_count_id_1.style.backgroundImage = "url('./img/emptylife.png')";
				} else if(life_count === 0){
					// 게임 종료 화면
					// 최대 몇문제 까지 갔는지 표시해주면될듯
					//clearInterval(startTime);
					life_count_id_0.style.backgroundImage = "url('./img/emptylife.png')";
					location.href = 'babyanimalsQuizResult.html?' + problem_num + '';
				} else {
					startTime = "";
					//setTimeProgress();
				}
			}
			
			function setProblemNum(){
				problem_num_text_id.innerHTML = "Round " + problem_num;
			}
			
			function setProblemImg(){
				problem_img_id.innerHTML = "<img src='./img/" + problem_img + ".jpg' class='problem-img'>"
			}
			
			function setAnswer(){
				answer_id.innerHTML = "";
				for(var i=0; i<answer.length; i++){
					answer_id.innerHTML += "<button class='answer-btn' onclick='answerFunc(" + i + ");'><span class='answer-text' id='answer_" + i + "'></span></button>"
				}
			}
			
			function setChoiceBtn(){
				// 배열에 정답 넣기
				choice_arr = new Array(10);
				for(var i=0; i<answer.length; i++){
					choice_arr[i] = answer.substring(i, i+1);
				}

				// 알파벳 배열
				alphabet_arr = Array.from({length:26}, (v,i) => String.fromCharCode(i+65));
				var tmp_alphabet_arr = alphabet_arr;
				//console.log(alphabet_arr);

				// 정답과 중복 검사
				for(var i=0; i<tmp_alphabet_arr.length; i++){
					for(var j=0; j<answer.length; j++){
						if(tmp_alphabet_arr[i] === answer.substring(j, j+1)){
							//console.log(tmp_alphabet_arr[i] + ", " + j);
							//console.log(answer.substring(j, j+1) + ", " + j);
							tmp_alphabet_arr.splice(i, 1);
						}
					}
				}

				// choice_arr 나머지부분 알파벳 채우기
				for(var i=0; i<choice_arr.length; i++){
					if(!choice_arr[i]){
						var rand = Math.floor(Math.random() * tmp_alphabet_arr.length);
						if(!duplicateChk(tmp_alphabet_arr[rand])){
							choice_arr[i] = tmp_alphabet_arr[rand];
						} else {
							i--;
						}
					}
				}
				
				// choice_arr 섞기
				shuffle(choice_arr);
				
				// 버튼에다가 choice_arr 값 넣기
				for(var i=0; i<choice_arr.length; i++){
					var choice = document.getElementById('choice_' + i);
					choice.innerHTML = choice_arr[i];
				}
			}
			
			function answerFunc(num){
				var answer_btn = document.getElementById('answer_' + num);
				
				//console.log(answer.textContent);
				if(answer_btn.textContent){
					answer_btn.innerHTML = "";
					answer_tmp_arr[num] = "";
					
				} 
				console.log(answer_tmp_arr);
			}
			
			function choiceFunc(num){
				var choice_btn = document.getElementById('choice_' + num);
				var answer_btn;
				var full_count = 0;
				
				for(var i=0; i<answer_tmp_arr.length; i++){
					if(!answer_tmp_arr[i]){
						answer_tmp_arr[i] = choice_btn.textContent;
						break;
					}
				}
				
				console.log(answer_tmp_arr);
				
				for(var i=0; i<answer_tmp_arr.length; i++){
					if(answer_tmp_arr[i]){
						answer_btn = document.getElementById('answer_' + i);
						answer_btn.innerHTML = answer_tmp_arr[i];
					} 
				}
				
				for(var i=0; i<answer_tmp_arr.length; i++){
					if(answer_tmp_arr[i]){
						full_count++;
					}
				}
				
				// 정답칸이 모두 채워줬을 경우 정답유무 판별
				// 정답이면 다음 문제
				// 오답이면 정답칸 다 지워주기(배열 비우기)
				if(full_count === answer.length){
					clearInterval(startTime);
					timeProgressChk = 0;
					startTime = "";
					var choiceAnswer = answer_tmp_arr.join('');
					console.log(choiceAnswer);
					console.log(answer);
					if(choiceAnswer === answer){
						// 정답
						console.log("problem_num : " + problem_num);
						
						if(problem_num == 5){
							location.href = 'babyanimalsQuizSuccess.html?' + problem_num + '';
						} else {
							problem_count++;
							setInit();
							//setTimeProgress();
							setProblemNum();
							setProblemImg();
							setAnswer();
							setChoiceBtn();
						}
					} else {
						// 오답
						answer_tmp_arr = new Array(answer.length);
						for(var i=0; i<answer.length; i++){
							answer_btn = document.getElementById('answer_' + i);
							answer_btn.innerHTML = "";
						}
						
						gameOverCheckFunc();
						/*
						life_count--;
						life_count_id.innerHTML = life_count;
						
						if(life_count == 0){
							// 게임 종료 화면
							// 최대 몇문제 까지 갔는지 표시해주면될듯
						}
						*/
					}
				}
			}
			
			function duplicateChk(value){
				return choice_arr.find((e) => (e === value));
			}

			function shuffle(array) {
				array.sort(() => Math.random() - 0.5);
			}
		</script>
		<!-- Optional JavaScript -->
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	</body>
</html>